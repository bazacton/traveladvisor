<?php/** * @weather  widget Class * */if ( !class_exists( 'traveladvisor_weather' ) ) {	class traveladvisor_weather extends WP_Widget {		/**		 * @init Recent posts Module		 *		 */		public function __construct() {			parent::__construct(					'traveladvisor_weather', // Base ID					traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather' ), // Name					array( 'classname' => 'widget-weather', 'description' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_desc' ), ) // Args			);		}		/**		 * @Recent posts html form		 *		 *		 */		function form( $instance ) {			global $traveladvisor_var_form_fields, $traveladvisor_var_html_fields;			$instance = wp_parse_args( ( array ) $instance, array( 'title' => '', 'city' => '', 'country' => '', 'cf' => '', 'num_of_days' => '' ) );			$title = '';			$city = '';			$country = '';			$cf = '';			$num_of_days = '';			$title = $instance['title'];			$city = $instance['city'];			$country = $instance['country'];			$cf = $instance['cf'];			$num_of_days = $instance['num_of_days'];			$traveladvisor_opt_array = array(				'name' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_title' ),				'desc' => '',				'hint_text' => '',				'echo' => true,				'field_params' => array(					'std' => esc_attr( $title ),					'id' => traveladvisor_allow_special_char( $this->get_field_id( 'title' ) ),					'classes' => '',					'cust_id' => traveladvisor_allow_special_char( $this->get_field_name( 'title' ) ),					'cust_name' => traveladvisor_allow_special_char( $this->get_field_name( 'title' ) ),					'return' => true,					'required' => false				),			);			$traveladvisor_var_html_fields->traveladvisor_var_text_field( $traveladvisor_opt_array );			$traveladvisor_opt_array = array(				'name' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_city' ),				'desc' => '',				'hint_text' => '',				'echo' => true,				'field_params' => array(					'std' => esc_attr( $city ),					'id' => traveladvisor_allow_special_char( $this->get_field_id( 'city' ) ),					'classes' => '',					'cust_id' => traveladvisor_allow_special_char( $this->get_field_name( 'city' ) ),					'cust_name' => traveladvisor_allow_special_char( $this->get_field_name( 'city' ) ),					'return' => true,					'required' => false				),			);			$traveladvisor_var_html_fields->traveladvisor_var_text_field( $traveladvisor_opt_array );			$traveladvisor_opt_array = array(				'name' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_country' ),				'desc' => '',				'hint_text' => '',				'echo' => true,				'field_params' => array(					'std' => esc_attr( $country ),					'id' => traveladvisor_allow_special_char( $this->get_field_id( 'country' ) ),					'classes' => '',					'cust_id' => traveladvisor_allow_special_char( $this->get_field_name( 'country' ) ),					'cust_name' => traveladvisor_allow_special_char( $this->get_field_name( 'country' ) ),					'return' => true,					'required' => false				),			);			$traveladvisor_var_html_fields->traveladvisor_var_text_field( $traveladvisor_opt_array );			$traveladvisor_opt_array = array(				'name' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_scale' ),				'desc' => '',				'hint_text' => '',				'echo' => true,				'field_params' => array(					'options' => array(						'c' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_centigrade' ),						'f' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_fahrenhite' ),					),					'std' => esc_attr( $cf ),					'id' => traveladvisor_allow_special_char( $this->get_field_id( 'cf' ) ),					'classes' => '',					'cust_id' => traveladvisor_allow_special_char( $this->get_field_name( 'cf' ) ),					'cust_name' => traveladvisor_allow_special_char( $this->get_field_name( 'cf' ) ),					'return' => true,					'required' => false				),			);			$traveladvisor_var_html_fields->traveladvisor_var_select_field( $traveladvisor_opt_array );			$traveladvisor_opt_array = array(				'name' => traveladvisor_var_theme_text_srt( 'traveladvisor_var_weather_no_of_days' ),				'desc' => '',				'hint_text' => '',				'echo' => true,				'field_params' => array(					'options' => array(						'1' => '1',						'2' => '2',						'3' => '3',						'4' => '4',						'5' => '5',						'6' => '6',						'7' => '7',						'8' => '8',						'9' => '9',						'10' => '10',					),					'std' => esc_attr( $num_of_days ),					'id' => traveladvisor_allow_special_char( $this->get_field_id( 'num_of_days' ) ),					'classes' => '',					'cust_id' => traveladvisor_allow_special_char( $this->get_field_name( 'num_of_days' ) ),					'cust_name' => traveladvisor_allow_special_char( $this->get_field_name( 'num_of_days' ) ),					'return' => true,					'required' => false				),			);			$traveladvisor_var_html_fields->traveladvisor_var_select_field( $traveladvisor_opt_array );		}		/**		 * @Recent posts update form data		 *		 *		 */		function update( $new_instance, $old_instance ) {			$instance = $old_instance;			$instance['title'] = $new_instance['title'];			$instance['city'] = $new_instance['city'];			$instance['country'] = $new_instance['country'];			$instance['cf'] = $new_instance['cf'];			$instance['num_of_days'] = $new_instance['num_of_days'];			return $instance;		}		/**		 * @Display Recent posts widget		 *		 */		function widget( $args, $instance ) {			global $traveladvisor_node, $wpdb, $post;			extract( $args, EXTR_SKIP );			$id = empty( $instance['id'] ) ? '' : apply_filters( 'widget_id', $instance['id'] );			$id = wp_specialchars_decode( stripslashes( $id ) );			$rand_id = rand( 123213, 9988833 );			$title = '';			$city = '';			$country = '';			$cf = '';			$num_of_days = '';			$location_weather_city = $instance['city'];			$location_weather_country = $instance['country'];			$title = $instance['title'];			$cf = $instance['cf'];			$num_of_days = $instance['num_of_days'];			$num_of_days = 10 - $num_of_days;			$output = '';			$widget_title = '';			if ( !empty( $title ) ) {				$widget_title = '<div class="widget-title"><h5>' . $title . '</h5></div>';			}			$output .= '<div class="widget widget-weather">' . $widget_title . '';			$output .= '<div id="location-weather-widget-' . $rand_id . '"></div>';			$output .= '</div><!--/#widget-->';			traveladvisor_enqueue_weather_widget_script();			$output .= "<script>		function loadWeatherWidget(location, woeid ,cf, days) {			jQuery.simpleWeather({				location: location,				woeid: woeid,				unit: cf,				success: function(weather) {                                        today = '<div class=\"weather-detail\">';                                        today += '<span class=\"cs-temperature\" ><img width = \"130px\" src=\"'+weather.image+'\"><em> '+weather.temp+'&deg;'+weather.units.temp+'</em><h2>'+location+'</h2></span><h3 class=\"cs-forecast\" >'+weather.currently+'</h3>';                                        today += '<h5>'+weather.forecast[0].day+ ' , ' +weather.forecast[0].date+'</h5>';                                         today += '<ul class=\"weather-list\">';					for(var i=1;i<weather.forecast.length-days;i++) {                                                today += '<li ><img width=\" 60px\" src=\"'+weather.forecast[i].image+'\"><span>'+weather.forecast[i].day+ '<br>'+weather.forecast[i].high+'&deg;'+weather.units.temp+'</span> </li>';					}                                        today += '</ul></div>';                                        jQuery('#location-weather-widget-$rand_id').html(today);				},				error: function(error) {					jQuery('#location-weather-widget-$rand_id').html('<p>'+error+'</p>');				}			});		}                jQuery(document).ready(function() {                        loadWeatherWidget('$location_weather_city','$location_weather_country','$cf','$num_of_days'); //@params location, woeid                });                </script>";			echo traveladvisor_allow_special_char( $output );		}	}}//if (function_exists('cs_widget_register')) {    //cs_widget_register('traveladvisor_weather');//}//add_action('widgets_init', function() {//    return register_widget("traveladvisor_weather");//});